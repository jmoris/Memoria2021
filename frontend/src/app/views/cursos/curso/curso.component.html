<div class="breadcrumb">
    <h1>Cursos</h1>
    <ul>
        <li>{{ curso?.nombre + ' ' + curso?.ano + '-' + curso?.semestre}}</li>
    </ul>
</div>
<div class="separator-breadcrumb border-top"></div>
<div class="module-loader" *ngIf="loading">
    <div class="spinner spinner-bubble spinner-bubble-primary mr-3"></div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="card o-hidden mb-4">
            <div class="row">
                <div class="col-md-2">
                    <div class="card o-hidden mb-4 ml-4 mt-4">
                        <div class="card-body text-center">
                            <i class="i-Add-User"></i>
                            <div class="content">
                                <p class="text-muted mt-2 mb-0">Carga de estudiantes
                                </p>
                                <button _ngcontent-tkm-c169="" class="btn btn-primary btn-rounded"
                                    (click)="fileInput.click();">Subir archivo</button>
                                <input #fileInput accept=".xlsx, .xls" type="file"
                                    (change)="handleFileInput($event.target.files, infoImportModal)"
                                    style="display:none;" />
                            </div>
                        </div>
                    </div>
                    <div class="card o-hidden mb-4 ml-4 mt-4">
                        <div class="card-body text-center">
                            <i class="i-Add-User"></i>
                            <div class="content">
                                <p class="text-muted mt-2 mb-0">Agregar Estudiante
                                </p>
                                <button class="btn btn-primary btn-rounded"
                                    (click)="addStudent(addStudentModal,$event)">Agregar </button>

                            </div>
                        </div>
                    </div>

                    <div class="card o-hidden mb-4 mt-4 ml-4">
                        <div class="card-body text-center">
                            <div class="content">
                                <p class="m-0 text-small text-muted">Estudiantes</p>
                                <p class="text-primary text-40 line-height-1 m-0">{{ this.stats.students }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="card o-hidden mb-4 mt-4 ml-4">
                        <div class="card-body text-center">
                            <div class="content">
                                <p class="m-0 text-small text-muted">Ayudantes </p>
                                <p class="text-success text-40 line-height-1 m-0">{{ this.stats.supports }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="card o-hidden mb-4 mt-4 ml-4">
                        <div class="card-body text-center">
                            <div class="content">
                                <p class="m-0 text-small text-muted">Profesores</p>
                                <p class="text-danger text-40 line-height-1 m-0">{{ this.stats.teachers }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-10">
                    <div class="card o-hidden mb-4 mt-4 mr-4">
                        <table mat-table [dataSource]="dataSource" matSort class="col-lg-12" matSortActive="rut"
                            matSortDirection="asc" matSortDisableClear>
                            <ng-container matColumnDef="matricula">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Matricula </th>
                                <td mat-cell *matCellDef="let element"> {{ ((element.matricula=='')?element.matricula:'No registra') }} </td>
                            </ng-container>

                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th>
                                <td mat-cell *matCellDef="let element"> {{element?.name + " " + element?.lastname}} </td>
                            </ng-container>

                            <ng-container matColumnDef="rut">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> RUT </th>
                                <td mat-cell *matCellDef="let element"> {{element?.rut}} </td>
                            </ng-container>

                            <ng-container matColumnDef="email">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
                                <td mat-cell *matCellDef="let element"> {{element?.email}} </td>
                            </ng-container>
                            <ng-container matColumnDef="rol">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Rol </th>
                                <td mat-cell *matCellDef="let element"> {{formatRol(element.pivot.role_id)}} </td>
                            </ng-container>
                            


                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        </table>

                        <mat-paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 15]" class="mat-elevation-z8">
                        </mat-paginator>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <ng-template #infoImportModal let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-title">Estadisticas carga masiva de estudiantes</h4>
            <button type="button" class="close" aria-label="Close button" aria-describedby="modal-title"
                (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <table class="table table-bordered table-sm" style="width:100%;">
                <tr>
                    <td width="60%">Usuarios cargados: </td>
                    <td>{{ carga.stats.cargados }}</td>
                </tr>
                <tr>
                    <td width="50%">Usuarios fallidos: </td>
                    <td>{{ carga.stats.fallidos.inexistentes.cantidad }}</td>
                </tr>
                <tr>
                    <td width="50%">Usuarios existentes: </td>
                    <td>{{ carga.stats.fallidos.existentes.cantidad }}</td>
                </tr>
            </table>
            <div style="height: 500px; width:100%; overflow:auto">
                <table class="table table-bordered table-sm" style="width:100%">
                    <thead>
                        <tr>
                            <td><b>Correos de usuarios</b></td>
                            <td><b>Estado</b></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of carga.stats.fallidos.inexistentes.detalle">
                            <td width="60%">{{ item}}</td>
                            <td width="40%">
                                <font color="red">Inexistente</font>
                            </td>
                        </tr>
                        <tr *ngFor="let item of carga.stats.fallidos.existentes.detalle">
                            <td width="60%">{{ item}}</td>
                            <td width="40%">
                                <font color="#ffcc00">Existente</font>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-danger btn-rounded"
                (click)="modal.dismiss('cancel')">Cerrar</button>
        </div>
    </ng-template>



    <ng-template #addStudentModal let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-title">Agregar Estudiante</h4>
            <button type="button" class="close" aria-label="Close button" aria-describedby="modal-title"
                (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="col-md-12 form-group mb-3">
                <label for="picker1">Estudiante a agregar </label>
                <select [(ngModel)]="estudianteAgregar" class="form-control">
                    <option *ngFor="let estudiante of estudiantes"  > {{estudiante.name  + " " + estudiante.lastname
                        + " "
                        + estudiante.email}} </option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" (click)="onCloseConfirm(modal)" class="btn btn-outline-primary m-1">Agregar</button>
        </div>
    </ng-template>


</div>
